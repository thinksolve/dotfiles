#!/usr/bin/env bash
set -euo pipefail #bash safety-header that makes scripts fail early and loudly

# usage:  youtube-txt  <youtube-url>  [output-name]
url=${1:? "YouTube URL required"}
name=${2:-transcript-$(date +%F_%H%M%S)}

tmp=$(mktemp).srt
trap 'rm -f "$tmp"' EXIT #delete tmp file no matter how script ends

yt-dlp --write-auto-sub --convert-subs srt \
	--skip-download --output "$tmp" "$url"

sed -E '/^[0-9]+$|^[0-9]{2}:/d; /^$/d' "$tmp".en.srt |
	sed 's/^[[:space:]]*//;s/[[:space:]]*$//' |
	awk '!seen[tolower($0)]++' >"$name".txt

echo "Plain-text transcript written to $name.txt"
